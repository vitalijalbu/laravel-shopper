type Query {
    # Products
    products(
        first: Int = 15
        page: Int
        search: String
        category: String
        brand: String
        minPrice: Float
        maxPrice: Float
        isActive: Boolean
        orderBy: [ProductOrderByClause!]
    ): ProductPaginator! @paginate(defaultCount: 15) @guard

    product(id: ID @eq): Product @find @guard

    # Categories
    categories(
        first: Int = 15
        page: Int
        search: String
        parentId: ID
        isEnabled: Boolean
        orderBy: [CategoryOrderByClause!]
    ): CategoryPaginator! @paginate(defaultCount: 15)

    category(id: ID @eq): Category @find

    # Brands
    brands(
        first: Int = 15
        page: Int
        search: String
        isActive: Boolean
    ): BrandPaginator! @paginate(defaultCount: 15)

    brand(id: ID @eq): Brand @find

    # Orders
    orders(
        first: Int = 15
        page: Int
        status: String
        userId: ID
        channelId: ID
        orderBy: [OrderOrderByClause!]
    ): OrderPaginator! @paginate(defaultCount: 15) @guard

    order(id: ID @eq): Order @find @guard

    # Customers
    customers(
        first: Int = 15
        page: Int
        search: String
        groupId: ID
        orderBy: [CustomerOrderByClause!]
    ): CustomerPaginator! @paginate(defaultCount: 15) @guard

    customer(id: ID @eq): Customer @find @guard

    # Metaobjects
    metaobjectDefinitions(
        first: Int = 15
        page: Int
        type: String
        isSingle: Boolean
    ): MetaobjectDefinitionPaginator! @paginate(defaultCount: 15) @guard

    metaobjectDefinition(id: ID @eq): MetaobjectDefinition @find @guard

    metaobjects(
        first: Int = 15
        page: Int
        definitionId: ID
        published: Boolean
        orderBy: [MetaobjectOrderByClause!]
    ): MetaobjectPaginator! @paginate(defaultCount: 15) @guard

    metaobject(id: ID @eq): Metaobject @find @guard

    # Analytics
    analyticsEvents(
        first: Int = 15
        page: Int
        eventType: String
        userId: String
        sessionId: String
        dateFrom: DateTime
        dateTo: DateTime
        orderBy: [AnalyticsEventOrderByClause!]
    ): AnalyticsEventPaginator! @paginate(defaultCount: 15) @guard

    analyticsMetrics(
        dateFrom: DateTime!
        dateTo: DateTime!
        eventTypes: [String!]
        groupBy: AnalyticsGroupBy
    ): [AnalyticsMetric!]! @guard

    # User Preferences
    userPreferences(
        userId: ID!
        type: String
    ): [UserPreference!]! @guard
}

type Mutation {
    # Products
    createProduct(input: CreateProductInput! @spread): Product! @guard
    updateProduct(id: ID!, input: UpdateProductInput! @spread): Product! @guard
    deleteProduct(id: ID!): Boolean! @guard

    # Categories  
    createCategory(input: CreateCategoryInput! @spread): Category! @guard
    updateCategory(id: ID!, input: UpdateCategoryInput! @spread): Category! @guard
    deleteCategory(id: ID!): Boolean! @guard

    # Brands
    createBrand(input: CreateBrandInput! @spread): Brand! @guard
    updateBrand(id: ID!, input: UpdateBrandInput! @spread): Brand! @guard
    deleteBrand(id: ID!): Boolean! @guard

    # Orders
    createOrder(input: CreateOrderInput! @spread): Order! @guard
    updateOrder(id: ID!, input: UpdateOrderInput! @spread): Order! @guard
    updateOrderStatus(id: ID!, status: String!): Order! @guard

    # Metaobjects
    createMetaobjectDefinition(input: CreateMetaobjectDefinitionInput! @spread): MetaobjectDefinition! @guard
    updateMetaobjectDefinition(id: ID!, input: UpdateMetaobjectDefinitionInput! @spread): MetaobjectDefinition! @guard
    deleteMetaobjectDefinition(id: ID!): Boolean! @guard

    createMetaobject(input: CreateMetaobjectInput! @spread): Metaobject! @guard
    updateMetaobject(id: ID!, input: UpdateMetaobjectInput! @spread): Metaobject! @guard
    deleteMetaobject(id: ID!): Boolean! @guard
    publishMetaobject(id: ID!): Metaobject! @guard
    unpublishMetaobject(id: ID!): Metaobject! @guard

    # Metafields
    setMetafield(input: SetMetafieldInput! @spread): Metafield! @guard
    deleteMetafield(id: ID!): Boolean! @guard

    # User Preferences
    setUserPreference(input: SetUserPreferenceInput! @spread): UserPreference! @guard
    deleteUserPreference(id: ID!): Boolean! @guard

    # Analytics
    trackAnalyticsEvent(input: TrackAnalyticsEventInput! @spread): AnalyticsEvent! @guard
}

# Types
type Product {
    id: ID!
    name: String!
    slug: String!
    sku: String
    description: String
    excerpt: String
    price: Int!
    comparePrice: Int
    costPerItem: Int
    isActive: Boolean!
    trackInventory: Boolean!
    inventoryQuantity: Int
    lowStockThreshold: Int
    weight: Float
    length: Float
    width: Float
    height: Float
    requiresShipping: Boolean!
    taxRate: Float
    seoTitle: String
    seoDescription: String
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    brand: Brand @belongsTo
    categories: [Category!]! @belongsToMany
    variants: [ProductVariant!]! @hasMany
    media: [Media!]! @morphMany
    metafields: [Metafield!]! @morphMany
    
    # Computed fields
    formattedPrice: String!
    formattedComparePrice: String
    inStock: Boolean!
    isOnSale: Boolean!
}

type Category {
    id: ID!
    name: String!
    slug: String!
    description: String
    parentId: ID
    sortOrder: Int
    isEnabled: Boolean!
    seoTitle: String
    seoDescription: String
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    parent: Category @belongsTo
    children: [Category!]! @hasMany
    products: [Product!]! @belongsToMany
    media: [Media!]! @morphMany
    metafields: [Metafield!]! @morphMany
}

type Brand {
    id: ID!
    name: String!
    slug: String!
    description: String
    website: String
    isActive: Boolean!
    sortOrder: Int
    seoTitle: String
    seoDescription: String
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    products: [Product!]! @hasMany
    media: [Media!]! @morphMany
    metafields: [Metafield!]! @morphMany
}

type Order {
    id: ID!
    number: String!
    userId: ID
    customerId: ID
    channelId: ID
    currencyCode: String!
    status: String!
    reference: String
    customerReference: String
    subTotal: Int!
    taxTotal: Int!
    discountTotal: Int!
    shippingTotal: Int!
    total: Int!
    notes: String
    exchangeRate: Float
    shippingOption: String
    shippingAddress: JSON
    billingAddress: JSON
    placedAt: DateTime
    meta: JSON
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    customer: Customer @belongsTo
    channel: Channel @belongsTo
    lines: [OrderLine!]! @hasMany
    
    # Computed fields
    formattedSubTotal: String!
    formattedTotal: String!
}

type Customer {
    id: ID!
    firstName: String!
    lastName: String!
    email: String!
    phone: String
    dateOfBirth: Date
    groupId: ID
    companyName: String
    vatNumber: String
    marketingOptIn: Boolean!
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    group: CustomerGroup @belongsTo
    orders: [Order!]! @hasMany
    addresses: [CustomerAddress!]! @hasMany
    metafields: [Metafield!]! @morphMany
    
    # Computed fields
    fullName: String!
    totalSpent: Float!
    orderCount: Int!
}

type MetaobjectDefinition {
    id: ID!
    name: String!
    type: String!
    description: String
    access: JSON
    capabilities: JSON
    displayableFields: JSON
    isSingle: Boolean!
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    metaobjects: [Metaobject!]! @hasMany
}

type Metaobject {
    id: ID!
    definitionId: ID!
    handle: String!
    fields: JSON!
    publishedAt: DateTime
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    definition: MetaobjectDefinition! @belongsTo
    
    # Computed fields
    isPublished: Boolean!
    displayName: String!
}

type Metafield {
    id: ID!
    definitionId: ID
    namespace: String!
    key: String!
    metafieldableType: String!
    metafieldableId: ID!
    value: String
    createdAt: DateTime!
    updatedAt: DateTime!
    
    # Relationships
    definition: MetafieldDefinition @belongsTo
    
    # Computed fields
    fullKey: String!
    castedValue: JSON
}

type UserPreference {
    id: ID!
    userId: ID!
    preferenceType: String!
    preferenceKey: String!
    preferenceValue: JSON!
    createdAt: DateTime!
    updatedAt: DateTime!
}

type AnalyticsEvent {
    id: ID!
    eventType: String!
    sessionId: String
    userId: String
    ipAddress: String
    userAgent: String
    referrer: String
    properties: JSON
    context: JSON
    occurredAt: DateTime!
    createdAt: DateTime!
    updatedAt: DateTime!
}

type AnalyticsMetric {
    date: String!
    eventType: String!
    count: Int!
    uniqueUsers: Int!
    uniqueSessions: Int!
    properties: JSON
}

# Input types
input CreateProductInput {
    name: String! @rules(apply: ["required", "string", "max:255"])
    slug: String @rules(apply: ["string", "max:255", "unique:products,slug"])
    sku: String @rules(apply: ["string", "max:255"])
    description: String
    price: Int! @rules(apply: ["required", "integer", "min:0"])
    comparePrice: Int @rules(apply: ["integer", "min:0"])
    isActive: Boolean = true
    trackInventory: Boolean = false
    inventoryQuantity: Int = 0
    brandId: ID
    categoryIds: [ID!]
}

input UpdateProductInput {
    name: String @rules(apply: ["string", "max:255"])
    slug: String @rules(apply: ["string", "max:255"])
    sku: String @rules(apply: ["string", "max:255"])
    description: String
    price: Int @rules(apply: ["integer", "min:0"])
    comparePrice: Int @rules(apply: ["integer", "min:0"])
    isActive: Boolean
    trackInventory: Boolean
    inventoryQuantity: Int
    brandId: ID
    categoryIds: [ID!]
}

input CreateCategoryInput {
    name: String! @rules(apply: ["required", "string", "max:255"])
    slug: String @rules(apply: ["string", "max:255", "unique:categories,slug"])
    description: String
    parentId: ID
    isEnabled: Boolean = true
}

input UpdateCategoryInput {
    name: String @rules(apply: ["string", "max:255"])
    slug: String @rules(apply: ["string", "max:255"])
    description: String
    parentId: ID
    isEnabled: Boolean
}

input CreateMetaobjectDefinitionInput {
    name: String! @rules(apply: ["required", "string", "max:255"])
    type: String! @rules(apply: ["required", "string", "max:255", "unique:metaobject_definitions,type"])
    description: String
    access: JSON
    capabilities: JSON
    displayableFields: JSON
    isSingle: Boolean = false
}

input UpdateMetaobjectDefinitionInput {
    name: String @rules(apply: ["string", "max:255"])
    description: String
    access: JSON
    capabilities: JSON
    displayableFields: JSON
    isSingle: Boolean
}

input CreateMetaobjectInput {
    definitionId: ID! @rules(apply: ["required", "exists:metaobject_definitions,id"])
    handle: String! @rules(apply: ["required", "string", "max:255", "unique:metaobjects,handle"])
    fields: JSON!
    publishedAt: DateTime
}

input UpdateMetaobjectInput {
    handle: String @rules(apply: ["string", "max:255"])
    fields: JSON
    publishedAt: DateTime
}

input SetMetafieldInput {
    metafieldableType: String! @rules(apply: ["required", "string"])
    metafieldableId: ID! @rules(apply: ["required"])
    namespace: String! @rules(apply: ["required", "string", "max:255"])
    key: String! @rules(apply: ["required", "string", "max:255"])
    value: String
}

input SetUserPreferenceInput {
    userId: ID! @rules(apply: ["required", "exists:users,id"])
    preferenceType: String! @rules(apply: ["required", "string", "max:255"])
    preferenceKey: String! @rules(apply: ["required", "string", "max:255"])
    preferenceValue: JSON!
}

input TrackAnalyticsEventInput {
    eventType: String! @rules(apply: ["required", "string", "max:255"])
    sessionId: String @rules(apply: ["string", "max:255"])
    userId: String @rules(apply: ["string", "max:255"])
    properties: JSON
    context: JSON
    occurredAt: DateTime
}

# Enums
enum AnalyticsGroupBy {
    DAY
    WEEK
    MONTH
    YEAR
}

# Order by clauses
input ProductOrderByClause {
    column: ProductOrderByColumn!
    order: SortOrder!
}

enum ProductOrderByColumn {
    ID
    NAME
    PRICE
    CREATED_AT
    UPDATED_AT
}

input CategoryOrderByClause {
    column: CategoryOrderByColumn!
    order: SortOrder!
}

enum CategoryOrderByColumn {
    ID
    NAME
    SORT_ORDER
    CREATED_AT
    UPDATED_AT
}

input OrderOrderByClause {
    column: OrderOrderByColumn!
    order: SortOrder!
}

enum OrderOrderByColumn {
    ID
    NUMBER
    TOTAL
    STATUS
    PLACED_AT
    CREATED_AT
    UPDATED_AT
}

input CustomerOrderByClause {
    column: CustomerOrderByColumn!
    order: SortOrder!
}

enum CustomerOrderByColumn {
    ID
    FIRST_NAME
    LAST_NAME
    EMAIL
    CREATED_AT
    UPDATED_AT
}

input MetaobjectOrderByClause {
    column: MetaobjectOrderByColumn!
    order: SortOrder!
}

enum MetaobjectOrderByColumn {
    ID
    HANDLE
    PUBLISHED_AT
    CREATED_AT
    UPDATED_AT
}

input AnalyticsEventOrderByClause {
    column: AnalyticsEventOrderByColumn!
    order: SortOrder!
}

enum AnalyticsEventOrderByColumn {
    ID
    EVENT_TYPE
    OCCURRED_AT
    CREATED_AT
}

enum SortOrder {
    ASC
    DESC
}
